var Sequelize = require('sequelize');

/////////////////////////////////////////////////////////////////////////////////////////////////////////
// Globals /////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////

var GAME_STATES = [
  'INPROG', 
  'COMPLETE'
];

var ROUND_STAGES = [
  'ROUND_1', 
  'ROUND_2', 
  'ROUND_3', 
  'ROUND_4', 
  'ROUND_5', 
  'ROUND_6', 
  'FACEOFF_1', 
  'FACEOFF_2', 
  'FACEOFF_3'
];

var SCORE_BONUSES = [
  'NONE',
  'SPEED'
];

/////////////////////////////////////////////////////////////////////////////////////////////////////////
// Model definitions ///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////

var User = {
  user_name: Sequelize.STRING
};

var Game = {
  state: Sequelize.ENUM(GAME_STATES),
  winner: Sequelize.INTEGER
};

var Round = {
  stage: Sequelize.ENUM(ROUND_STAGES),
  acronym: Sequelize.ARRAY(Sequelize.STRING),
  validator: Sequelize.STRING
};

var Score = {
  score: Sequelize.INTEGER,
  bonus: Sequelize.ENUM(SCORE_BONUSES)
};

/////////////////////////////////////////////////////////////////////////////////////////////////////////
// Private methods /////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////

function _define(connection, modelName, model) {
  try {
    return connection.define(modelName, model);  
  } catch (ex) {
    console.error(ex);
  }
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////
// Public methods //////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////

function _defineAll(connection) {
  
  if (connection && connection.define) {
    
    // Define each Model
    
    var users = _define(connection, 'user', User);
    var games = _define(connection, 'game', Game);
    var rounds = _define(connection, 'round', Round);
    var scores = _define(connection, 'score', Score);
    
    // Define Model Associations
    
    // users.belongsTo(games);
    // rounds.belongsTo(games);
    // scores.hasMany(users, rounds);
  } else {
    console.error('A valid Sequelize connection is required.');
  }
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////
// Export //////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////

module.exports = {
  defineAllModels: _defineAll
}